<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

      <link rel="stylesheet" href="css/main.css">

      <script src="http://maps.googleapis.com/maps/api/js?libraries=weather,visualization,places&sensor=true&language=en&v=3.14"></script>

  </head>
  <body class="" ng-app="app">

    <!-- Add your site or application content here -->
    <div id="wrapper" class="wrapper" ui-view=""></div>

    <script src="cordova.js"></script>
    <script src="cdv-plugin-fb-connect.js"></script>
    <script src="facebook-js-sdk.js"></script>
    <script src="PushNotification.js"></script>

    <script src="js/app.js"></script>



    <script type="text/javascript" charset="utf-8">

      var pushNotification;

      document.addEventListener("deviceready", function () {
        if (typeof FB == 'undefined') {
          alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');
        }
        FB.init({ appId: "599935056750513", nativeInterface: CDV.FB, useCachedDialogs: false });

        pushNotification = window.plugins.pushNotification;


        function errorHandler (error) {
            alert('error = ' + error);
        }

        function successHandler (result) {
            alert('result = ' + result);
        }

        function onNotificationGCM(e) {
            $("ion-content").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');

            switch( e.event )
            {
            case 'registered':
                if ( e.regid.length > 0 )
                {
                    $("ion-content").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
                    // Your GCM push server needs to know the regID before it can push to this device
                    // here is where you might want to send it the regID for later use.
                    console.log("regID = " + e.regid);
                }
            break;

            case 'message':
                // if this flag is set, this notification happened while we were in the foreground.
                // you might want to play a sound to get the user's attention, throw up a dialog, etc.
                if ( e.foreground )
                {
                    $("ion-content").append('<li>--INLINE NOTIFICATION--' + '</li>');

                    // if the notification contains a soundname, play it.
                    var my_media = new Media("/android_asset/www/"+e.soundname);
                    my_media.play();
                }
                else
                {  // otherwise we were launched because the user touched a notification in the notification tray.
                    if ( e.coldstart )
                    {
                        $("ion-content").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
                    }
                    else
                    {
                        $("ion-content").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
                    }
                }

                $("ion-content").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
                $("ion-content").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
            break;

            case 'error':
                $("ion-content").append('<li>ERROR -> MSG:' + e.msg + '</li>');
            break;

            default:
                $("ion-content").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
            break;
          }
        }

        if ( device.platform == 'android' || device.platform == 'Android' )
        {
            pushNotification.register(
              successHandler,
              errorHandler, {
                  "senderID":"633864311576",
                  "ecb":"onNotificationGCM"
              });
        }

        onDeviceReady()
      });

      function onDeviceReady() {
        console.log('app loaded');
      }

      // onError: Failed to get the contacts
      function onError(contactError) {
        alert('onError!');
      }

    </script>
  </body>
</html>
